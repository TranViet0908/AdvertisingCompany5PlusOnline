<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Thanh toán hợp đồng</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
          rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card-hover:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .service-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .service-card:hover {
            background: linear-gradient(145deg, #f8fafc 0%, #ffffff 100%);
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }
        .hero-pattern {
            background-image: radial-gradient(circle at 25% 25%, #667eea 0%, transparent 50%),
                            radial-gradient(circle at 75% 75%, #764ba2 0%, transparent 50%);
        }
    </style>
</head>
<body class="font-sans bg-gray-50">
<div th:replace="~{/user/contracts/_tabs :: tabs('payments')}"></div>

<!-- Header -->
<header class="hero-pattern text-white relative overflow-hidden">
    <div class="absolute inset-0 bg-black/20"></div>
    <div class="container mx-auto px-4 lg:px-8 py-16 relative z-10">
        <div class="max-w-4xl mx-auto text-center">
            <div class="mb-6">
                <i class="fas fa-credit-card text-6xl text-white/80 mb-4"></i>
            </div>
            <h1 class="text-4xl md:text-6xl font-bold mb-6 leading-tight">
                Thanh toán
            </h1>
            <p class="text-xl md:text-2xl text-white/90 leading-relaxed max-w-3xl mx-auto">
                Tổng hợp công nợ và thanh toán thêm một cách an toàn và tiện lợi
            </p>
        </div>
    </div>
</header>

<main class="container mx-auto px-4 lg:px-8 py-16">
    <!-- Notifications -->
    <div th:if="${success}" class="max-w-4xl mx-auto mb-8">
        <div class="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 text-green-800 px-6 py-4 rounded-2xl shadow-lg">
            <div class="flex items-center">
                <i class="fas fa-check-circle text-2xl mr-4"></i>
                <span th:text="${success}" class="font-medium"></span>
            </div>
        </div>
    </div>

    <div th:if="${error}" class="max-w-4xl mx-auto mb-8">
        <div class="bg-gradient-to-r from-red-50 to-pink-50 border border-red-200 text-red-800 px-6 py-4 rounded-2xl shadow-lg">
            <div class="flex items-center">
                <i class="fas fa-exclamation-circle text-2xl mr-4"></i>
                <span th:text="${error}" class="font-medium"></span>
            </div>
        </div>
    </div>

    <!-- Summary Cards -->
    <section class="max-w-7xl mx-auto mb-16 px-4">
        <!-- Heading -->
        <div class="text-center mb-12">
            <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
                Tổng quan <span class="gradient-text">tài chính</span>
            </h2>
            <div class="w-24 h-1 bg-gradient-to-r from-blue-500 to-purple-600 mx-auto"></div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <!-- Tổng giá trị -->
            <div class="service-card p-8 rounded-3xl shadow-lg card-hover text-center bg-white">
                <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-6">
                    <!-- File/Invoice (outline) -->
                    <svg viewBox="0 0 24 24" class="w-8 h-8 text-white" fill="none"
                         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                         aria-hidden="true">
                        <path d="M14 3H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 3 14 8 19 8"></polyline>
                        <line x1="8" y1="12" x2="16" y2="12"></line>
                        <line x1="8" y1="16" x2="14" y2="16"></line>
                    </svg>
                </div>
                <div class="text-sm text-gray-500 mb-2">Tổng giá trị</div>
                <div class="text-3xl font-bold text-gray-900 mb-2"
                     th:text="${#numbers.formatDecimal(summary.total,0,'POINT',0,'COMMA')} + ' VNĐ'">0 VNĐ
                </div>
                <div class="text-sm text-gray-600">Tổng giá trị hợp đồng</div>
            </div>

            <!-- Đã thanh toán -->
            <div class="service-card p-8 rounded-3xl shadow-lg card-hover text-center bg-white">
                <div class="w-16 h-16 bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl flex items-center justify-center mx-auto mb-6">
                    <!-- Circle check (outline) -->
                    <svg viewBox="0 0 24 24" class="w-8 h-8 text-white" fill="none"
                         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                         aria-hidden="true">
                        <circle cx="12" cy="12" r="9"></circle>
                        <path d="M9 12l2 2 4-4"></path>
                    </svg>
                </div>
                <div class="text-sm text-gray-500 mb-2">Đã thanh toán</div>
                <div class="text-3xl font-bold text-green-600 mb-2"
                     th:text="${#numbers.formatDecimal(summary.paid,0,'POINT',0,'COMMA')} + ' VNĐ'">0 VNĐ
                </div>
                <div class="text-sm text-gray-600">Số tiền đã thanh toán</div>
            </div>

            <!-- Còn lại -->
            <div class="service-card p-8 rounded-3xl shadow-lg card-hover text-center bg-white">
                <div
                        class="w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-6"
                        style="
                              /* Lớp 1: ICON (trên)  — Lớp 2: GRADIENT (dưới) */
                              background-image:
                                url('data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\'><path fill=\'%23ffffff\' d=\'M6 2h12a1 1 0 0 1 0 2H6a1 1 0 1 1 0-2Zm0 20h12a1 1 0 0 0 0-2H6a1 1 0 1 0 0 2Zm8-12.5c1.3-.9 2-2.1 2-3.5H8c0 1.4.7 2.6 2 3.5l2 1.4 2-1.4ZM8 18h8c0-1.4-.7-2.6-2-3.5L12 13l-2 1.5c-1.3.9-2 2.1-2 3.5Z\'/></svg>'),
                                linear-gradient(to right, #f97316, #ef4444);
                              background-repeat: no-repeat, no-repeat;
                              background-position: center, center;
                              background-size: 32px 32px, 100% 100%;
                            ">
                </div>
                <div class="text-sm text-gray-500 mb-2">Còn lại</div>
                <div class="text-3xl font-bold text-orange-600 mb-2"
                     th:text="${#numbers.formatDecimal(summary.outstanding,0,'POINT',0,'COMMA')} + ' VNĐ'">0 VNĐ
                </div>
                <div class="text-sm text-gray-600">Số tiền cần thanh toán</div>
            </div>
        </div>
    </section>

    <!-- Payment List -->
    <section class="max-w-7xl mx-auto">
        <div class="text-center mb-12">
            <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
                Chi tiết <span class="gradient-text">thanh toán</span>
            </h2>
            <div class="w-24 h-1 bg-gradient-to-r from-blue-500 to-purple-600 mx-auto"></div>
        </div>

        <!-- Empty State -->
        <div th:if="${#lists.isEmpty(payments)}" class="max-w-2xl mx-auto text-center">
            <div class="service-card p-12 rounded-3xl shadow-lg">
                <div class="mb-8">
                    <i class="fas fa-receipt text-6xl text-gray-300"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-900 mb-4">Chưa có dữ liệu thanh toán</h3>
                <p class="text-gray-600 text-lg leading-relaxed">
                    Hiện tại chưa có thông tin thanh toán nào được ghi nhận trong hệ thống.
                </p>
            </div>
        </div>

        <!-- Payment Table -->
        <div th:if="${!#lists.isEmpty(payments)}" class="service-card rounded-3xl shadow-lg">
            <div class="overflow-x-auto lg:overflow-visible">
                <table class="w-full table-auto">
                    <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                    <tr class="text-xs md:text-sm text-gray-700">
                        <th class="px-6 py-4 text-left font-bold uppercase tracking-wide">
                            <i class="fas fa-file-contract mr-2 text-blue-500"></i>Tên hợp đồng
                        </th>
                        <th class="px-6 py-4 text-left font-bold uppercase tracking-wide whitespace-nowrap">
                            <i class="fas fa-calendar mr-2 text-purple-500"></i>Ngày ký
                        </th>
                        <th class="px-6 py-4 text-left font-bold uppercase tracking-wide whitespace-nowrap">
                            <i class="fas fa-dollar-sign mr-2 text-green-500"></i>Tổng tiền
                        </th>
                        <th class="px-6 py-4 text-left font-bold uppercase tracking-wide whitespace-nowrap">
                            <i class="fas fa-check mr-2 text-blue-500"></i>Đã thanh toán
                        </th>
                        <th class="px-6 py-4 text-left font-bold uppercase tracking-wide whitespace-nowrap">
                            <i class="fas fa-clock mr-2 text-orange-500"></i>Còn lại
                        </th>
                        <th class="px-6 py-4 text-left font-bold uppercase tracking-wide whitespace-nowrap">
                            <i class="fas fa-info-circle mr-2 text-indigo-500"></i>Trạng thái
                        </th>
                        <th class="px-6 py-4 text-left font-bold uppercase tracking-wide whitespace-nowrap">
                            <i class="fas fa-cog mr-2 text-gray-500"></i>Thao tác
                        </th>
                    </tr>
                    </thead>

                    <tbody class="divide-y divide-gray-100">
                    <tr th:each="p : ${payments}" class="align-top hover:bg-gray-50 transition-colors">
                        <!-- Tên -->
                        <td class="px-6 py-5">
                            <div class="font-semibold text-gray-900 break-words" th:text="${p.name}">Chiến dịch</div>
                        </td>

                        <!-- Ngày ký -->
                        <td class="px-6 py-5 whitespace-nowrap text-gray-600"
                            th:text="${#temporals.format(p.signDate,'dd/MM/yyyy')}">--/--/----</td>

                        <!-- Tổng tiền -->
                        <td class="px-6 py-5 whitespace-nowrap">
            <span class="font-semibold text-gray-900"
                  th:text="${#numbers.formatDecimal(p.totalCost,0,'POINT',0,'COMMA')} + ' VNĐ'">0 VNĐ</span>
                        </td>

                        <!-- Đã thanh toán -->
                        <td class="px-6 py-5 whitespace-nowrap">
            <span class="font-semibold text-green-600"
                  th:text="${#numbers.formatDecimal(p.amountPaid,0,'POINT',0,'COMMA')} + ' VNĐ'">0 VNĐ</span>
                        </td>

                        <!-- Còn lại -->
                        <td class="px-6 py-5 whitespace-nowrap">
            <span class="font-semibold text-orange-600"
                  th:text="${#numbers.formatDecimal(p.outstanding,0,'POINT',0,'COMMA')} + ' VNĐ'">0 VNĐ</span>
                        </td>

                        <!-- Trạng thái -->
                        <td class="px-6 py-5">
            <span th:replace="~{/user/contracts/_status-badge :: badge(${p.status})}"
                  class="px-3 py-1 rounded-full text-xs font-semibold"></span>
                        </td>

                        <!-- Thao tác -->
                        <td class="px-6 py-5">
                            <div th:if="${p.outstanding == 0}" class="text-gray-500 font-medium whitespace-nowrap">
                                <i class="fas fa-check-circle text-green-500 mr-2"></i>Đã thanh toán đủ
                            </div>

                            <form th:if="${p.outstanding > 0}"
                                  th:action="@{/user/contracts/payments/{id}/pay(id=${p.id})}"
                                  method="post"
                                  class="flex flex-col sm:flex-row gap-2 items-stretch sm:items-center justify-end">
                                <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}"/>

                                <input name="pay_amount" type="number" step="1000" min="1000"
                                       th:attr="max=${p.outstanding}"
                                       class="w-full sm:w-28 border-2 border-gray-200 rounded-xl px-3 py-2 text-right
                            focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                       placeholder="Số tiền (VNĐ)" required/>

                                <button type="submit"
                                        class="inline-flex items-center justify-center px-4 py-2 rounded-xl
                             bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold
                             hover:shadow-lg transition duration-300">
                                    <i class="fas fa-credit-card mr-2"></i>Thanh toán
                                </button>
                            </form>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>
</main>

<!-- Footer CTA -->
<section class="py-20 bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900">
    <div class="container mx-auto px-4 lg:px-8">
        <div class="max-w-4xl mx-auto text-center">
            <h2 class="text-3xl md:text-4xl font-bold text-white mb-6">
                Cần hỗ trợ thanh toán?
            </h2>
            <p class="text-xl text-gray-300 mb-8 leading-relaxed">
                Đội ngũ tài chính của chúng tôi luôn sẵn sàng hỗ trợ bạn với mọi thắc mắc về thanh toán
            </p>
            <div class="flex flex-col sm:flex-row justify-center gap-4">
                <a href="#contact"
                   class="inline-flex items-center px-8 py-4 rounded-full bg-white text-blue-600 font-semibold hover:bg-gray-100 transition duration-300 transform hover:scale-105">
                    <i class="fas fa-headset mr-3"></i>
                    Hỗ trợ thanh toán
                </a>
                <a href="#"
                   class="inline-flex items-center px-8 py-4 rounded-full border-2 border-white text-white font-semibold hover:bg-white hover:text-blue-600 transition duration-300 transform hover:scale-105">
                    <i class="fas fa-shield-alt mr-3"></i>
                    Bảo mật thanh toán
                </a>
            </div>
        </div>
    </div>
</section>
</body>
</html>